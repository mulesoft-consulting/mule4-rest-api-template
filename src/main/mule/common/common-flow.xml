<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:error-handler-plugin="http://www.mulesoft.org/schema/mule/error-handler-plugin" xmlns:json-logger="http://www.mulesoft.org/schema/mule/json-logger"
	xmlns:validation="http://www.mulesoft.org/schema/mule/validation"
	xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/validation http://www.mulesoft.org/schema/mule/validation/current/mule-validation.xsd
http://www.mulesoft.org/schema/mule/json-logger http://www.mulesoft.org/schema/mule/json-logger/current/mule-json-logger.xsd
http://www.mulesoft.org/schema/mule/error-handler-plugin http://www.mulesoft.org/schema/mule/error-handler-plugin/current/mule-error-handler-plugin.xsd">
	<sub-flow name="assigning-correlation-id" doc:id="cf764f69-6b6d-4e43-a25d-d7c670ea7e20" >
		<try doc:name="Try" doc:id="6c616aae-8187-40b8-8a81-3085e763b22f">
				<choice doc:name="Choice" doc:id="5cf7312b-5ebe-497d-b7c6-35a03ada9346">
					<when expression="#[p('correlation.impose') == &quot;true&quot;]">
<!-- 						<validation:is-not-null doc:name="Is not null" doc:id="0dbf57a3-0c94-4ce4-8b86-52e8d77d3348" value='#[attributes.headers."x-correlation-id"]'> 
					<error-mapping sourceType="VALIDATION:NULL" targetType="APP:NULL_CORRELATION" />
				</validation:is-not-null>-->
						<validation:is-not-null doc:name="Is not null" doc:id="a5c62ea0-c6cd-42ab-a673-5c33ff511feb" value='#[attributes.headers."x-correlation-id"]' />
						<set-variable value='#[attributes.headers."x-correlation-id"]' doc:name="set correlationId variable" doc:id="71e865b4-653a-4bb3-87d9-a8fac212f0b0" variableName="correlationId" />
					</when>
					<otherwise>
				<set-variable value='#[if (attributes.headers."x-correlation-id" != null) 
	attributes.headers."x-correlation-id"
else
	correlationId]' doc:name="correlationId" doc:id="98018968-f642-4fb2-ada7-d0f5e89c5cc2" variableName="correlationId" doc:description="Message.correlationId will be automatically populated by the HTTP Listener when no X-Correlation-ID header value given. In this setter, we will take the value from the X-Correlation-ID header if value present, otherwise get it from the message.correlationId that is autogenerated." />
			</otherwise>
		</choice>
				<error-handler>
					<on-error-propagate enableNotifications="true" logException="true" doc:name="handle all errors" doc:id="2ed06031-486d-433c-8e95-6b16317b8afd" type="ANY">
						<raise-error doc:name="Raise error" doc:id="666d73bd-84a1-428a-bff6-7a22b1a0a3b7" type="TECHNICAL:CORRELATION_ID_REQUIRED"/>
					</on-error-propagate>
				</error-handler>
			</try>
	</sub-flow>
</mule>
